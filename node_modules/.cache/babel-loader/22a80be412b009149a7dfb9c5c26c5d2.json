{"ast":null,"code":"var _jsxFileName = \"D:\\\\Workspace\\\\react\\\\test\\\\src\\\\AppInitializer.tsx\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect } from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { login, logout } from './store/actions';\nimport { LinearProgress } from '@mui/material';\nimport logo from './assets/images/logo.jpg';\nimport auth from './services/auth';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nconst AppInitializer = props => {\n  _s();\n\n  const dispatch = useDispatch();\n  const isLogin = useSelector(state => state.isLogin);\n  const isInitialized = useSelector(state => state.init);\n  const theme = useSelector(state => state.theme);\n\n  const verifyToken = async () => {\n    let authSession = localStorage.getItem('auth');\n    let user = {};\n\n    if (authSession) {\n      authSession = JSON.parse(authSession);\n      user = {\n        token: authSession.token,\n        UserID: authSession.UserID\n      };\n    }\n\n    let res = await auth.verifyToken(user);\n\n    if (res.success && res.data) {\n      // dispath login\n      dispatch(login(res.data));\n    } else {\n      dispatch(logout());\n    }\n  };\n\n  document.body.classList.add(`theme-${theme ? theme : 'bp'}`);\n  useEffect(() => {\n    if (!isLogin) {\n      verifyToken();\n    }\n  }, [isLogin]);\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: isInitialized ? props.children : /*#__PURE__*/_jsxDEV(SiteLoader, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 48,\n      columnNumber: 43\n    }, this)\n  }, void 0, false);\n};\n\n_s(AppInitializer, \"Y9Wc3oD4z80BPijFiWNHa3bBgL4=\", false, function () {\n  return [useDispatch, useSelector, useSelector, useSelector];\n});\n\n_c = AppInitializer;\n\nconst SiteLoader = () => {\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(\"img\", {\n        src: logo\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 57,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(LinearProgress, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 58,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 56,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 55,\n    columnNumber: 9\n  }, this);\n};\n\n_c2 = SiteLoader;\nexport default AppInitializer;\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"AppInitializer\");\n$RefreshReg$(_c2, \"SiteLoader\");","map":{"version":3,"names":["React","useEffect","useSelector","useDispatch","login","logout","LinearProgress","logo","auth","AppInitializer","props","dispatch","isLogin","state","isInitialized","init","theme","verifyToken","authSession","localStorage","getItem","user","JSON","parse","token","UserID","res","success","data","document","body","classList","add","children","SiteLoader"],"sources":["D:/Workspace/react/test/src/AppInitializer.tsx"],"sourcesContent":["import React,{useState,useEffect} from 'react';\r\n\r\nimport { useSelector, useDispatch } from 'react-redux'\r\nimport {login,logout} from './store/actions';\r\nimport { Icon, LinearProgress } from '@mui/material';\r\n\r\nimport logo from './assets/images/logo.jpg';\r\nimport auth from './services/auth';\r\n\r\n\r\nconst AppInitializer = (props:any)=>{\r\n    const dispatch = useDispatch();\r\n    const isLogin = useSelector((state:any)=>state.isLogin);\r\n    const isInitialized = useSelector((state:any)=>state.init);\r\n    const theme = useSelector((state:any)=>state.theme);\r\n\r\n    const verifyToken = async()=>{\r\n        \r\n        let authSession:any = localStorage.getItem('auth');\r\n        let user = {};\r\n        if(authSession){\r\n            authSession = JSON.parse(authSession);\r\n            user = {token:authSession.token,UserID:authSession.UserID};\r\n        }\r\n        let res:any = await auth.verifyToken(user);\r\n        if(res.success && res.data){\r\n            // dispath login\r\n            dispatch(login(res.data));\r\n        }else{\r\n            dispatch(logout());\r\n        }\r\n    }\r\n\r\n    document.body.classList.add(`theme-${theme?theme:'bp'}`)\r\n\r\n    useEffect(()=>{\r\n        if(!isLogin){\r\n            verifyToken();   \r\n           \r\n        }\r\n    },[isLogin])\r\n\r\n\r\n    \r\n    \r\n    return (\r\n        <>\r\n            {isInitialized?props.children:<SiteLoader/>}\r\n        </>\r\n    )\r\n}\r\n\r\nconst SiteLoader = ()=>{\r\n    return (\r\n        <div >\r\n            <div >\r\n                <img src={logo}/>\r\n                <LinearProgress/> \r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default AppInitializer;\r\n\r\n"],"mappings":";;;AAAA,OAAOA,KAAP,IAAuBC,SAAvB,QAAuC,OAAvC;AAEA,SAASC,WAAT,EAAsBC,WAAtB,QAAyC,aAAzC;AACA,SAAQC,KAAR,EAAcC,MAAd,QAA2B,iBAA3B;AACA,SAAeC,cAAf,QAAqC,eAArC;AAEA,OAAOC,IAAP,MAAiB,0BAAjB;AACA,OAAOC,IAAP,MAAiB,iBAAjB;;;;AAGA,MAAMC,cAAc,GAAIC,KAAD,IAAa;EAAA;;EAChC,MAAMC,QAAQ,GAAGR,WAAW,EAA5B;EACA,MAAMS,OAAO,GAAGV,WAAW,CAAEW,KAAD,IAAaA,KAAK,CAACD,OAApB,CAA3B;EACA,MAAME,aAAa,GAAGZ,WAAW,CAAEW,KAAD,IAAaA,KAAK,CAACE,IAApB,CAAjC;EACA,MAAMC,KAAK,GAAGd,WAAW,CAAEW,KAAD,IAAaA,KAAK,CAACG,KAApB,CAAzB;;EAEA,MAAMC,WAAW,GAAG,YAAS;IAEzB,IAAIC,WAAe,GAAGC,YAAY,CAACC,OAAb,CAAqB,MAArB,CAAtB;IACA,IAAIC,IAAI,GAAG,EAAX;;IACA,IAAGH,WAAH,EAAe;MACXA,WAAW,GAAGI,IAAI,CAACC,KAAL,CAAWL,WAAX,CAAd;MACAG,IAAI,GAAG;QAACG,KAAK,EAACN,WAAW,CAACM,KAAnB;QAAyBC,MAAM,EAACP,WAAW,CAACO;MAA5C,CAAP;IACH;;IACD,IAAIC,GAAO,GAAG,MAAMlB,IAAI,CAACS,WAAL,CAAiBI,IAAjB,CAApB;;IACA,IAAGK,GAAG,CAACC,OAAJ,IAAeD,GAAG,CAACE,IAAtB,EAA2B;MACvB;MACAjB,QAAQ,CAACP,KAAK,CAACsB,GAAG,CAACE,IAAL,CAAN,CAAR;IACH,CAHD,MAGK;MACDjB,QAAQ,CAACN,MAAM,EAAP,CAAR;IACH;EACJ,CAfD;;EAiBAwB,QAAQ,CAACC,IAAT,CAAcC,SAAd,CAAwBC,GAAxB,CAA6B,SAAQhB,KAAK,GAACA,KAAD,GAAO,IAAK,EAAtD;EAEAf,SAAS,CAAC,MAAI;IACV,IAAG,CAACW,OAAJ,EAAY;MACRK,WAAW;IAEd;EACJ,CALQ,EAKP,CAACL,OAAD,CALO,CAAT;EAUA,oBACI;IAAA,UACKE,aAAa,GAACJ,KAAK,CAACuB,QAAP,gBAAgB,QAAC,UAAD;MAAA;MAAA;MAAA;IAAA;EADlC,iBADJ;AAKH,CAxCD;;GAAMxB,c;UACeN,W,EACDD,W,EACMA,W,EACRA,W;;;KAJZO,c;;AA0CN,MAAMyB,UAAU,GAAG,MAAI;EACnB,oBACI;IAAA,uBACI;MAAA,wBACI;QAAK,GAAG,EAAE3B;MAAV;QAAA;QAAA;QAAA;MAAA,QADJ,eAEI,QAAC,cAAD;QAAA;QAAA;QAAA;MAAA,QAFJ;IAAA;MAAA;MAAA;MAAA;IAAA;EADJ;IAAA;IAAA;IAAA;EAAA,QADJ;AAQH,CATD;;MAAM2B,U;AAWN,eAAezB,cAAf"},"metadata":{},"sourceType":"module"}